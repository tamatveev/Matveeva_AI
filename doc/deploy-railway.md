# Деплой бота на Railway

Railway подхватывает проект по GitHub, собирает образ из `Dockerfile` и запускает контейнер. Секреты задаются переменными окружения в личном кабинете.

## 1. Подготовка

- Репозиторий проекта на GitHub (все изменения закоммичены и запушены).
- Аккаунт на [railway.app](https://railway.app). Бесплатный план даёт ежемесячный кредит — для одного лёгкого бота обычно хватает.

## 2. Создание проекта в Railway

1. Зайди на [railway.app](https://railway.app) и войди через GitHub.
2. **New Project** → **Deploy from GitHub repo**.
3. Выбери репозиторий с ботом и разреши доступ, если попросит.
4. Railway создаст сервис и начнёт сборку по `Dockerfile` из корня репозитория. Первый деплой может упасть из‑за отсутствия переменных — это нормально, их добавим ниже.

## 3. Переменные окружения

В проекте открой свой сервис (один сервис = один контейнер). Вкладка **Variables** (или **Settings** → Variables).

Добавь **все** переменные из твоего `.env` по одной (или вставь через **RAW Editor**, если Railway предлагает вставить из `.env`):

| Переменная | Описание |
|------------|----------|
| `TELEGRAM_BOT_TOKEN` | Токен бота от @BotFather |
| `OPENROUTER_API_KEY` | Ключ OpenRouter |
| `LLM_MODEL` | Модель, например `google/gemini-2.0-flash-001` |
| `MAX_HISTORY_MESSAGES` | Число, например `20` |
| `GOOGLE_SHEETS_SERVICES_URL` | URL таблицы «Услуги» |
| `GOOGLE_SHEETS_ORDERS_URL` | URL таблицы «Заявки» |
| `GOOGLE_DOC_PROMPT_URL` | URL документа с промтом (если используется) |
| `BEST_EXAMPLE_URL` | Ссылка на пример (если используется) |
| `LOG_LEVEL` | По желанию, например `INFO` |

**Ключ Google (сервисный аккаунт):**

На Railway нельзя загрузить файл. Нужно передать содержимое `service_account.json` одной переменной:

1. Открой свой `service_account.json` в редакторе.
2. Скопируй **весь** JSON (от `{` до `}`).
3. В Railway создай переменную **`GOOGLE_SERVICE_ACCOUNT_JSON`** и вставь туда этот текст целиком (как одну строку или с переносами — оба варианта подходят).

Переменную **`GOOGLE_APPLICATION_CREDENTIALS`** на Railway задавать не нужно — бот сам создаёт временный файл из `GOOGLE_SERVICE_ACCOUNT_JSON`.

## 4. Деплой и проверка

1. После сохранения переменных Railway пересоберёт и перезапустит сервис (или нажми **Deploy** / **Redeploy** вручную).
2. В логах сервиса (вкладка **Deployments** → выбери деплой → **View Logs**) должно быть сообщение вроде «Ключ Google взят из переменной GOOGLE_SERVICE_ACCOUNT_JSON» и старт бота без ошибок.
3. Напиши боту в Telegram — он должен отвечать, работая на Railway 24/7 (пока не кончится бесплатный кредит или сервис не остановят).

## 5. Полезное

- **Логи:** в Railway всегда смотри логи деплоя — по ним видно падения и ошибки конфигурации.
- **Перезапуск:** при изменении переменных Railway делает новый деплой. При пуше в GitHub тоже можно настроить автодеплой.
- **Локально** по‑прежнему используй `GOOGLE_APPLICATION_CREDENTIALS` с путём к файлу и не задавай `GOOGLE_SERVICE_ACCOUNT_JSON` — тогда поведение не меняется.
